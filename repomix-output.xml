This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.continue/
  agents/
    new-config.yaml
app/
  actions/
    consumeItem.ts
    createPrinted.ts
    updateProcess.ts
  dashboad/
    components/
      SummaryCard.tsx
    constants.ts
    data.ts
    page.tsx
    types.ts
    utils.ts
  item/
    [id]/
      page.tsx
  print/
    page.tsx
  globals.css
  layout.tsx
lib/
  supabase.ts
.gitignore
next.config.js
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.json
tsconfig.node.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/dashboad/components/SummaryCard.tsx">
// app/dashboard/components/SummaryCard.tsx
import React from 'react';

interface SummaryCardProps {
  title: string;
  value: number | string;
  valueColor?: string;
}

export function SummaryCard({ title, value, valueColor = 'text-gray-800' }: SummaryCardProps) {
  return (
    <div className="bg-white p-6 rounded-xl shadow-lg flex items-center">
      <div>
        <p className="text-lg text-gray-500">{title}</p>
        <p className={`text-5xl font-extrabold ${valueColor}`}>{value}</p>
      </div>
    </div>
  );
}
</file>

<file path="app/dashboad/constants.ts">
import { Process } from './types';

export const PROCESSES: { key: Process; name: string }[] = [
  { key: 'UNPRINTED', name: '未プリント' },
  { key: 'PRINTED', name: 'プリント済み' },
  { key: 'SURFACE_TREATMENT', name: '表面処理' },
  { key: 'CUTTING', name: '切削' },
  { key: 'PAINTING', name: '塗装' },
  { key: 'READY', name: '準備完了' },
];
</file>

<file path="app/dashboad/data.ts">
// app/dashboad/data.ts
import { Part, PartItem } from './types';

export const parts: Part[] = [
  { id: 1, part_number: 'PART-A' },
  { id: 2, part_number: 'PART-B' }
];

export const partItems: PartItem[] = [
  { id: 101, part_id: 1, storage_case: 'Case-01', current_process: 'PRINTED', completed_at: null },
  { id: 102, part_id: 2, storage_case: 'Case-02', current_process: 'READY', completed_at: new Date() }
];
</file>

<file path="app/dashboad/page.tsx">
import Link from 'next/link';
import { PROCESSES } from './constants';
import { aggregateProgress } from './utils';
import { SummaryCard } from './components/SummaryCard';
// data.ts から直接インポートするように一時的に変更
import { parts, partItems } from './data'; 

/**
 * ダッシュボードページ
 * サービス層実装前の暫定構成として、直接データを参照します。
 */
export default function DashboardPage() {
  // 1. 本来はサービス層で行う集計・計算をここで行う
  const totalInventory = partItems.length;
  const inProgress = partItems.filter(item => item.current_process !== 'READY').length;
  
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const completedToday = partItems.filter(item => 
    item.completed_at && new Date(item.completed_at) >= today
  ).length;

  // 2. マトリックス表示用にデータを集計（引数にデータを渡す）
  const progressData = aggregateProgress(parts, partItems);

  return (
    <div className="bg-gray-50 min-h-screen p-4 sm:p-6 lg:p-8 font-sans">
      <header className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
        <h1 className="text-3xl font-bold text-gray-800 mb-4 sm:mb-0">
          工程進捗ダッシュボード
        </h1>
        <Link href="/print">
          <span className="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-all cursor-pointer inline-block text-lg">
            3Dプリント登録
          </span>
        </Link>
      </header>

      {/* サマリーカード */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <SummaryCard title="総在庫数" value={totalInventory} />
        <SummaryCard title="仕掛品数 (工程進行中)" value={inProgress} valueColor="text-orange-500" />
        <SummaryCard title="本日完了数" value={completedToday} valueColor="text-green-500" />
      </div>

      {/* 工程進捗マトリックス */}
      <div className="bg-white rounded-xl shadow-lg overflow-x-auto">
        <table className="w-full text-left">
          <thead className="bg-gray-100">
            <tr>
              <th className="p-4 text-lg font-semibold text-gray-700 sticky left-0 bg-gray-100 z-10 w-64 min-w-[250px]">
                部品番号 / 保管ケース
              </th>
              {PROCESSES.map(proc => (
                <th key={proc.key} className="p-4 text-lg font-semibold text-center text-gray-700 whitespace-nowrap min-w-[120px]">
                  {proc.name}
                </th>
              ))}
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200">
            {progressData.map(data => (
              <tr key={data.part_number} className="hover:bg-gray-50">
                <td className="p-4 sticky left-0 bg-white hover:bg-gray-50 z-10 border-r">
                  <div className="font-bold text-lg text-gray-900">{data.part_number}</div>
                  <div className="text-sm text-gray-500 mt-1">
                    {data.storage_cases.join(', ')}
                  </div>
                </td>
                {PROCESSES.map(proc => {
                  const count = data.counts[proc.key];
                  const part = parts.find(p => p.part_number === data.part_number);
                  const linkHref = part ? `/item/${part.id}?process=${proc.key}` : '#';

                  return (
                    <td key={proc.key} className="p-4 text-center">
                      <Link href={linkHref}>
                        <div 
                          className={`
                            text-2xl font-bold rounded-lg w-20 h-14 flex items-center justify-center mx-auto cursor-pointer
                            transition-all duration-200 transform hover:scale-110 hover:shadow-lg
                            ${count > 0 ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-400'}
                          `}
                        >
                          {count}
                        </div>
                      </Link>
                    </td>
                  );
                })}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
</file>

<file path="app/dashboad/types.ts">
export type Process = 
  | 'UNPRINTED'
  | 'PRINTED'
  | 'SURFACE_TREATMENT'
  | 'CUTTING'
  | 'PAINTING'
  | 'READY';

export interface Part {
  id: number;
  part_number: string;
}

export interface PartItem {
  id: number;
  part_id: number;
  storage_case: string;
  current_process: Process;
  completed_at: Date | null;
}

export interface ProgressData {
  part_number: string;
  storage_cases: string[];
  counts: Record<Process, number>;
}
</file>

<file path="app/dashboad/utils.ts">
import { Part, PartItem, ProgressData, Process } from './types';

export const aggregateProgress = (parts: Part[], partItems: PartItem[]): ProgressData[] => {
  const progressMap = new Map<string, { storage_cases: Set<string>; counts: Record<Process, number> }>();

  parts.forEach(part => {
    progressMap.set(part.part_number, {
      storage_cases: new Set(),
      counts: {
        UNPRINTED: 0, PRINTED: 0, SURFACE_TREATMENT: 0,
        CUTTING: 0, PAINTING: 0, READY: 0,
      },
    });
  });

  partItems.forEach(item => {
    const part = parts.find(p => p.id === item.part_id);
    if (part) {
      const currentData = progressMap.get(part.part_number);
      if (currentData) {
        currentData.counts[item.current_process]++;
        currentData.storage_cases.add(item.storage_case);
      }
    }
  });

  return Array.from(progressMap.entries()).map(([part_number, data]) => ({
    part_number,
    storage_cases: Array.from(data.storage_cases).sort(),
    counts: data.counts,
  }));
};
</file>

<file path=".continue/agents/new-config.yaml">
# This is an example configuration file
# To learn more, see the full config.yaml reference: https://docs.continue.dev/reference

name: Example Config
version: 1.0.0
schema: v1

# Define which models can be used
# https://docs.continue.dev/customization/models
models:
  - name: my gpt-5
    provider: openai
    model: gpt-5
    apiKey: YOUR_OPENAI_API_KEY_HERE
  - uses: ollama/qwen2.5-coder-7b
  - uses: anthropic/claude-4-sonnet
    with:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

# MCP Servers that Continue can access
# https://docs.continue.dev/customization/mcp-tools
mcpServers:
  - uses: anthropic/memory-mcp
</file>

<file path="app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
</file>

<file path=".gitignore">
# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# local env files
.env*.local
.env

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
Thumbs.db
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
}

module.exports = nextConfig
</file>

<file path="postcss.config.js">
module.exports = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}
</file>

<file path="README.md">
# SN-923
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "es2017",
    "useDefineForClassFields": true,
    "lib": [
      "es2020",
      "dom",
      "dom.iterable"
    ],
    "module": "esnext",
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    /* Next.js */
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "incremental": true,
    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowJs": true,
    "strict": false,
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="app/actions/consumeItem.ts">
'use server' // このファイルがサーバーサイドで実行されることを示す

import { supabase } from '@/lib/supabase'

/**
 * 部品アイテムを消費済みにするサーバーアクション
 * @param itemId - 消費する部品アイテムのID
 */
export async function consumeItem(itemId: string) {
  await supabase
    .from('part_items') // 'part_items'テーブルを選択
    .update({
      status: 'consumed', // ステータスを'consumed'（消費済み）に更新
      current_process: 'assembled', // 現在の工程を'assembled'（組み立て済み）に更新
      storage_case_id: null // 保管ケースIDをnullに設定
    })
    .eq('id', itemId) // 指定されたIDのアイテムを対象とする
}
</file>

<file path="app/actions/createPrinted.ts">
'use server' // このファイルがサーバーサイドで実行されることを示す

import { supabase } from '@/lib/supabase'

/**
 * 3Dプリントされた新しい部品アイテムを作成するサーバーアクション
 * @param partId - 部品のID
 * @param qty - 数量
 * @param storageCaseId - 保管ケースのID
 */
export async function createPrinted(
  partId: string,
  qty: number,
  storageCaseId: string
) {
  // 指定された数量だけループを実行
  for (let i = 0; i < qty; i++) {
    // 'part_items'テーブルに新しいレコードを挿入
    const { data, error } = await supabase
      .from('part_items')
      .insert({
        part_id: partId, // 部品ID
        current_process: 'printed', // 現在の工程を'printed'に設定
        storage_case_id: storageCaseId // 保管ケースID
      })
      .select() // 挿入したレコードをSELECT
      .single() // 単一のレコードとして取得

    // 挿入が成功した場合
    if (data) {
      // 'part_process_logs'テーブルに工程ログを挿入
      await supabase.from('part_process_logs').insert({
        part_item_id: data.id, // 新しく作成された部品アイテムのID
        process: 'printed' // 工程名
      })
    }

    // エラーが発生した場合は、エラーをスロー
    if (error) throw error
  }
}
</file>

<file path="app/actions/updateProcess.ts">
'use server' // このファイルがサーバーサイドで実行されることを示す

import { supabase } from '@/lib/supabase'

/**
 * 部品アイテムの工程を更新するサーバーアクション
 * @param itemId - 更新する部品アイテムのID
 * @param nextProcess - 次の工程名
 */
export async function updateProcess(
  itemId: string,
  nextProcess: string
) {
  // 'part_items'テーブルの現在の工程を更新
  await supabase
    .from('part_items')
    .update({ current_process: nextProcess }) // 'current_process'カラムを新しい工程名で更新
    .eq('id', itemId) // 指定されたIDのアイテムを対象とする

  // 'part_process_logs'テーブルに新しい工程ログを挿入
  await supabase.from('part_process_logs').insert({
    part_item_id: itemId, // 部品アイテムのID
    process: nextProcess // 新しい工程名
  })
}
</file>

<file path="app/item/[id]/page.tsx">
// Supabaseクライアントとサーバーアクションをインポート
import { supabase } from '@/lib/supabase'
import { updateProcess } from '@/app/actions/updateProcess'
import { consumeItem } from '@/app/actions/consumeItem'

// 利用可能な工程のリスト
const PROCESS = [
  'printed', // 印刷済み
  'surface', // 表面処理
  'machining', // 機械加工
  'painting', // 塗装
  'ready' // 準備完了
]

// アイテム詳細ページのコンポーネント
export default async function ItemPage({ params }: any) {
  // URLのパラメータからアイテムIDを使用して、Supabaseから特定の部品アイテムのデータを取得
  const { data } = await supabase
    .from('part_items')
    .select(`
      id,
      current_process,
      parts ( part_number )
    `)
    .eq('id', params.id) // IDでフィルタリング
    .single() as any // 単一のレコードを取得

  return (
    <div>
      {/* 部品番号を表示 */}
      <h1>{(data?.parts as any)?.[0]?.part_number || data?.parts?.part_number}</h1>
      {/* 現在の工程を表示 */}
      <p>現在工程: {data?.current_process}</p>

      {/* 工程更新フォーム */}
      <form action={async (formData) => {
        'use server'
        // updateProcessサーバーアクションを呼び出して、工程を更新
        await updateProcess(
          data.id,
          formData.get('next') as string
        )
      }}>
        {/* 次の工程を選択するドロップダウン */}
        <select name="next">
          {PROCESS.map(p => (
            <option key={p} value={p}>{p}</option>
          ))}
        </select>
        <button>工程更新</button>
      </form>

      {/* 組み込み完了フォーム */}
      <form action={async () => {
        'use server'
        // consumeItemサーバーアクションを呼び出して、アイテムを消費済みにする
        await consumeItem(data.id)
      }}>
        <button>組み込み完了</button>
      </form>
    </div>
  )
}
</file>

<file path="app/print/page.tsx">
// サーバーアクションとSupabaseクライアントをインポート
import { createPrinted } from '../actions/createPrinted'
import { supabase } from '@/lib/supabase'

// 3Dプリント登録ページのコンポーネント
export default async function PrintPage() {
  // Supabaseから部品と保管ケースのデータを取得
  const { data: parts } = await supabase.from('parts').select() as any
  const { data: cases } = await supabase.from('storage_cases').select() as any

  return (
    // フォーム送信時にサーバーアクションを実行
    <form action={async (formData: any) => {
      'use server' // この関数をサーバーサイドで実行することを示す
      // createPrintedサーバーアクションを呼び出して、新しいプリントアイテムを作成
      await createPrinted(
        formData.get('part') as string, // フォームから部品IDを取得
        Number(formData.get('qty')), // フォームから数量を取得し、数値に変換
        formData.get('case') as string // フォームからケースIDを取得
      )
    }}>
      <h1>3Dプリント完了</h1>

      {/* 部品選択のドロップダウン */}
      <select name="part">
        {parts?.map((p: any) => (
          <option key={p.id} value={p.id}>{p.part_number}</option>
        ))}
      </select>

      {/* 数量入力フィールド */}
      <input name="qty" type="number" defaultValue={1} />

      {/* 保管ケース選択のドロップダウン */}
      <select name="case">
        {cases?.map((c: any) => (
          <option key={c.id} value={c.id}>{c.name}</option>
        ))}
      </select>

      {/* 登録ボタン */}
      <button type="submit">登録</button>
    </form>
  )
}
</file>

<file path="app/layout.tsx">
import './globals.css'
import type { Metadata } from "next"

export const metadata: Metadata = {
  title: "SN-923",
  description: "在庫管理アプリケーション",
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ja">
      <body>{children}</body>
    </html>
  )
}
</file>

<file path="lib/supabase.ts">
// Supabaseクライアントをインポート
import { createClient } from '@supabase/supabase-js'

// SupabaseのURLとサービスロールキーを環境変数から取得
// 環境変数が設定されていない場合は、プレースホルダーの値を使用
const supabaseUrl = process.env.SUPABASE_URL || 'https://placeholder.supabase.co'
const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || 'placeholder-key'

// Supabaseクライアントを作成
export const supabase = createClient(
  supabaseUrl,
  supabaseKey, // PoCなのでOK
  { auth: { persistSession: false } } // サーバーサイドでのみ使用するため、セッションの永続化は無効にする
)
</file>

<file path="package.json">
{
  "name": "sn-923",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.38.0",
    "@tailwindcss/postcss": "^4.1.18",
    "next": "^14.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "^5.3.0"
  }
}
</file>

</files>
