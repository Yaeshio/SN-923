This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.continue/agents/new-config.yaml
.gitignore
app/actions/consumeItem.ts
app/actions/createPrinted.ts
app/actions/updateProcess.ts
app/components/CartModal.tsx
app/components/SummaryCard.tsx
app/constants.ts
app/data.ts
app/globals.css
app/item/[id]/page.tsx
app/layout.tsx
app/page.tsx
app/print/page.tsx
app/project/[id]/page.tsx
app/project/[id]/ProjectClientContent.tsx
app/types.ts
app/utils.ts
lib/mockStore.ts
next.config.js
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.json
tsconfig.node.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".continue/agents/new-config.yaml">
# This is an example configuration file
# To learn more, see the full config.yaml reference: https://docs.continue.dev/reference

name: Example Config
version: 1.0.0
schema: v1

# Define which models can be used
# https://docs.continue.dev/customization/models
models:
  - name: my gpt-5
    provider: openai
    model: gpt-5
    apiKey: YOUR_OPENAI_API_KEY_HERE
  - uses: ollama/qwen2.5-coder-7b
  - uses: anthropic/claude-4-sonnet
    with:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

# MCP Servers that Continue can access
# https://docs.continue.dev/customization/mcp-tools
mcpServers:
  - uses: anthropic/memory-mcp
</file>

<file path=".gitignore">
# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# local env files
.env*.local
.env

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
Thumbs.db
</file>

<file path="app/components/CartModal.tsx">
'use client';

import React from 'react';

interface CartItem {
    id: number;
    part_number: string;
    count: number;
}

interface CartModalProps {
    isOpen: boolean;
    onClose: () => void;
    items: CartItem[];
    onDownload: () => void;
}

export function CartModal({ isOpen, onClose, items, onDownload }: CartModalProps) {
    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4">
            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden">
                <div className="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h2 className="text-2xl font-bold text-gray-800">プリント用カート</h2>
                    <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div className="p-6 max-h-[60vh] overflow-y-auto">
                    {items.length === 0 ? (
                        <p className="text-center text-gray-500 py-8">カートに部品が入っていません。</p>
                    ) : (
                        <table className="w-full">
                            <thead className="text-xs text-gray-400 uppercase border-b">
                                <tr>
                                    <th className="text-left pb-2">部品番号</th>
                                    <th className="text-right pb-2">ダウンロード数量</th>
                                    <th className="text-right pb-2">ファイル名</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {items.map((item) => (
                                    <tr key={item.id}>
                                        <td className="py-4 font-semibold text-gray-800">{item.part_number}</td>
                                        <td className="py-4 text-right">
                                            <input
                                                type="number"
                                                defaultValue={item.count}
                                                className="w-16 border rounded p-1 text-right"
                                            />
                                        </td>
                                        <td className="py-4 text-right text-sm text-gray-500 font-mono">
                                            {item.part_number}.stl
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    )}
                </div>

                <div className="p-6 bg-gray-50 flex gap-4">
                    <button
                        onClick={onClose}
                        className="flex-1 px-6 py-3 rounded-xl border border-gray-300 font-bold text-gray-600 hover:bg-white transition-colors"
                    >
                        戻る
                    </button>
                    <button
                        onClick={onDownload}
                        disabled={items.length === 0}
                        className="flex-1 px-6 py-3 rounded-xl bg-green-600 text-white font-bold hover:bg-green-700 transition-colors shadow-lg disabled:bg-gray-300"
                    >
                        Zipで一括ダウンロード
                    </button>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="app/components/SummaryCard.tsx">
// app/dashboard/components/SummaryCard.tsx
import React from 'react';

interface SummaryCardProps {
  title: string;
  value: number | string;
  valueColor?: string;
}

export function SummaryCard({ title, value, valueColor = 'text-gray-800' }: SummaryCardProps) {
  return (
    <div className="bg-white p-6 rounded-xl shadow-lg flex items-center">
      <div>
        <p className="text-lg text-gray-500">{title}</p>
        <p className={`text-5xl font-extrabold ${valueColor}`}>{value}</p>
      </div>
    </div>
  );
}
</file>

<file path="app/constants.ts">
import { Process } from './types';

export const PROCESSES: { key: Process; name: string }[] = [
  { key: 'UNPRINTED', name: '未プリント' },
  { key: 'PRINTED', name: 'プリント済み' },
  { key: 'SURFACE_TREATMENT', name: '表面処理' },
  { key: 'CUTTING', name: '切削' },
  { key: 'PAINTING', name: '塗装' },
  { key: 'READY', name: '準備完了' },
];
</file>

<file path="app/project/[id]/ProjectClientContent.tsx">
'use client';

import React, { useState } from 'react';
import Link from 'next/link';
import { PROCESSES } from '@/app/constants';
import { CartModal } from '@/app/components/CartModal';

export default function ProjectClientContent({ progressData, projectId, projectName }: any) {
    const [selectedIds, setSelectedIds] = useState<number[]>([]);
    const [isCartOpen, setIsCartOpen] = useState(false);

    const toggleSelection = (id: number) => {
        setSelectedIds(prev =>
            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]
        );
    };

    const cartItems = progressData
        .filter((d: any) => selectedIds.includes(d.id))
        .map((d: any) => ({ id: d.id, part_number: d.part_number, count: d.count }));

    const handleDownload = () => {
        alert(`${selectedIds.length}件のファイルをZipにまとめてダウンロードを開始します（モック）`);
        setIsCartOpen(false);
        setSelectedIds([]);
    };

    return (
        <>
            <div className="bg-white rounded-xl shadow-lg overflow-x-auto mb-20">
                <table className="w-full text-left">
                    <thead className="bg-gray-100">
                        <tr>
                            <th className="p-4 w-12">
                                <input
                                    type="checkbox"
                                    onChange={(e) => {
                                        if (e.target.checked) setSelectedIds(progressData.map((d: any) => d.id));
                                        else setSelectedIds([]);
                                    }}
                                    className="w-5 h-5 rounded border-gray-300 text-blue-600"
                                />
                            </th>
                            <th className="p-4 text-lg font-semibold text-gray-700">部品番号 / 進捗</th>
                            <th className="p-4 text-lg font-semibold text-gray-700 text-center">ステータス</th>
                            <th className="p-4 text-lg font-semibold text-gray-700">保管場所</th>
                            <th className="p-4 text-right">操作</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-200">
                        {progressData.map((data: any) => {
                            const processInfo = PROCESSES.find(p => p.key === data.current_process);
                            const isSelected = selectedIds.includes(data.id);

                            return (
                                <tr key={data.id} className={`${isSelected ? 'bg-blue-50' : ''} hover:bg-gray-50 transition-colors`}>
                                    <td className="p-4">
                                        <input
                                            type="checkbox"
                                            checked={isSelected}
                                            onChange={() => toggleSelection(data.id)}
                                            className="w-5 h-5 rounded border-gray-300 text-blue-600 cursor-pointer"
                                        />
                                    </td>
                                    <td className="p-4">
                                        <div className="font-bold text-gray-900">{data.part_number}</div>
                                        <div className="text-xs text-gray-400">数量: {data.count}</div>
                                    </td>
                                    <td className="p-4 text-center">
                                        <span className={`px-4 py-1.5 rounded-full font-bold text-xs ${data.current_process === 'READY' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'
                                            }`}>
                                            {processInfo?.name || data.current_process}
                                        </span>
                                    </td>
                                    <td className="p-4 text-sm text-gray-600">
                                        {data.storage_cases.join(', ') || '-'}
                                    </td>
                                    <td className="p-4 text-right">
                                        <Link href={`/item/${data.id}`}>
                                            <button className="text-blue-600 hover:text-blue-800 font-semibold text-sm">詳細</button>
                                        </Link>
                                    </td>
                                </tr>
                            );
                        })}
                    </tbody>
                </table>
            </div>

            {/* フローティング・カートボタン */}
            {selectedIds.length > 0 && (
                <div className="fixed bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-6 bg-white border border-blue-200 shadow-2xl px-8 py-4 rounded-2xl z-50 animate-in fade-in slide-in-from-bottom-4">
                    <div>
                        <span className="text-2xl font-black text-blue-600">{selectedIds.length}</span>
                        <span className="ml-2 font-bold text-gray-600">件を選択中</span>
                    </div>
                    <button
                        onClick={() => setIsCartOpen(true)}
                        className="bg-blue-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-blue-700 transition-colors shadow-lg shadow-blue-200 flex items-center gap-2"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        カートに追加して確認
                    </button>
                </div>
            )}

            <CartModal
                isOpen={isCartOpen}
                onClose={() => setIsCartOpen(false)}
                items={cartItems}
                onDownload={handleDownload}
            />
        </>
    );
}
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
}

module.exports = nextConfig
</file>

<file path="postcss.config.js">
module.exports = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}
</file>

<file path="README.md">
# SN-923
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "es2017",
    "useDefineForClassFields": true,
    "lib": [
      "es2020",
      "dom",
      "dom.iterable"
    ],
    "module": "esnext",
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    /* Next.js */
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "incremental": true,
    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowJs": true,
    "strict": false,
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="app/data.ts">
// app/data.ts
import { Part, PartItem, Project } from './types';

export const projects: Project[] = [
  { id: 1, name: '次世代ドローン開発', description: '高解像度カメラ搭載の新型ドローン開発プロジェクト', deadline: '2026-06-30' },
  { id: 2, name: '搬送ロボット製作', description: '倉庫内自動配送を行う自律走行ロボットの試作', deadline: '2026-04-15' }
];

export const parts: Part[] = [
  { id: 1, part_number: 'PART-A', project_id: 1 },
  { id: 2, part_number: 'PART-B', project_id: 1 },
  { id: 3, part_number: 'PART-C', project_id: 2 }
];

export const partItems: PartItem[] = [
  { id: 101, part_id: 1, storage_case: 'Case-01', current_process: 'PRINTED', completed_at: null },
  { id: 102, part_id: 2, storage_case: 'Case-02', current_process: 'READY', completed_at: new Date() },
  { id: 103, part_id: 3, storage_case: 'Case-03', current_process: 'UNPRINTED', completed_at: null }
];
</file>

<file path="app/globals.css">
@import "tailwindcss";
</file>

<file path="app/layout.tsx">
import './globals.css'
import type { Metadata } from "next"

export const metadata: Metadata = {
  title: "SN-923",
  description: "在庫管理アプリケーション",
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ja">
      <body>{children}</body>
    </html>
  )
}
</file>

<file path="app/types.ts">
export type Process =
  | 'UNPRINTED'
  | 'PRINTED'
  | 'SURFACE_TREATMENT'
  | 'CUTTING'
  | 'PAINTING'
  | 'READY';

export interface Project {
  id: number;
  name: string;
  description: string;
  deadline: string;
}

export interface Part {
  id: number;
  part_number: string;
  project_id: number;
}

export interface PartItem {
  id: number;
  part_id: number;
  storage_case: string;
  current_process: Process;
  completed_at: Date | null;
}

export interface ProgressData {
  part_number: string;
  storage_cases: string[];
  counts: Record<Process, number>;
}
</file>

<file path="app/utils.ts">
// app/utils.ts
import { Part, PartItem, ProgressData, Process } from './types';
import { PROCESSES } from './constants';

export const aggregateProgress = (parts: Part[], partItems: PartItem[]): any[] => {
  return parts.map(part => {
    const items = partItems.filter(item => item.part_id === part.id);

    // この部品の中で最も「進んでいない」工程を現在の工程とする
    // (全て完了していれば READY となる)
    const processOrder = PROCESSES.map(p => p.key);
    const currentProcess = items.length > 0
      ? items.reduce((earliest, item) => {
        return processOrder.indexOf(item.current_process) < processOrder.indexOf(earliest)
          ? item.current_process
          : earliest;
      }, 'READY' as Process)
      : 'UNPRINTED';

    return {
      id: part.id,
      part_number: part.part_number,
      current_process: currentProcess,
      storage_cases: Array.from(new Set(items.map(i => i.storage_case))),
      count: items.length
    };
  });
};
</file>

<file path="lib/mockStore.ts">
import { Part, PartItem, Process, Project } from '@/app/types';
import { parts as initialParts, partItems as initialPartItems, projects as initialProjects } from '@/app/data';

// サーバーサイドでのメモリストア（シングルトン）
// Next.jsのHMR（Hot Module Replacement）でリセットされないように global を使用
declare global {
    var __mock_store: {
        projects: Project[];
        parts: Part[];
        partItems: PartItem[];
    } | undefined;
}

if (!global.__mock_store) {
    global.__mock_store = {
        projects: [...initialProjects],
        parts: [...initialParts],
        partItems: [...initialPartItems],
    };
}

const store = global.__mock_store!;

export const mockStore = {
    getProjects: async (): Promise<Project[]> => {
        return store.projects;
    },

    getProject: async (id: number): Promise<Project | null> => {
        return store.projects.find(p => p.id === id) || null;
    },

    getParts: async (projectId?: number): Promise<Part[]> => {
        if (projectId) {
            return store.parts.filter(p => p.project_id === projectId);
        }
        return store.parts;
    },

    getPartItems: async (projectId?: number): Promise<PartItem[]> => {
        if (projectId) {
            const projectParts = store.parts.filter(p => p.project_id === projectId);
            const partIds = projectParts.map(p => p.id);
            return store.partItems.filter(i => partIds.includes(i.part_id));
        }
        return store.partItems;
    },

    getPartItem: async (id: number): Promise<(PartItem & { parts: Part }) | null> => {
        const item = store.partItems.find((i) => i.id === id);
        if (!item) return null;
        const part = store.parts.find((p) => p.id === item.part_id);
        return { ...item, parts: part! };
    },

    updatePartItem: async (id: number, updates: Partial<PartItem>): Promise<void> => {
        const index = store.partItems.findIndex((i) => i.id === id);
        if (index !== -1) {
            store.partItems[index] = { ...store.partItems[index], ...updates };
        }
    },

    addPartItem: async (item: Omit<PartItem, 'id'>): Promise<PartItem> => {
        const newId = Math.max(0, ...store.partItems.map((i) => i.id)) + 1;
        const newItem = { ...item, id: newId };
        store.partItems.push(newItem);
        return newItem;
    },

    // localStorage への保存・読み込み（ブラウザ側で呼び出す場合を想定）
    // サーバーアクション内では動作しませんが、クライアントコンポーネント用として用意
    saveToLocalStorage: () => {
        if (typeof window !== 'undefined') {
            localStorage.setItem('mock_projects', JSON.stringify(store.projects));
            localStorage.setItem('mock_parts', JSON.stringify(store.parts));
            localStorage.setItem('mock_partItems', JSON.stringify(store.partItems));
        }
    },

    loadFromLocalStorage: () => {
        if (typeof window !== 'undefined') {
            const savedProjects = localStorage.getItem('mock_projects');
            const savedParts = localStorage.getItem('mock_parts');
            const savedItems = localStorage.getItem('mock_partItems');
            if (savedProjects) store.projects = JSON.parse(savedProjects);
            if (savedParts) store.parts = JSON.parse(savedParts);
            if (savedItems) store.partItems = JSON.parse(savedItems);
        }
    }
};
</file>

<file path="app/actions/consumeItem.ts">
'use server'

import { mockStore } from '@/lib/mockStore'
import { revalidatePath } from 'next/cache'

/**
 * 部品アイテムを消費済みにするサーバーアクション
 * @param itemId - 消費する部品アイテムのID
 */
export async function consumeItem(itemId: string | number) {
  const id = typeof itemId === 'string' ? parseInt(itemId, 10) : itemId;

  await mockStore.updatePartItem(id, {
    current_process: 'READY', // 本来のロジックに合わせてREADYにするか、または別のステータス
    completed_at: new Date(),
    storage_case: 'CONSUMED' // 便宜上の表記
  });

  console.log(`Consumed item ${id}`);

  revalidatePath('/');
  revalidatePath(`/item/${id}`);
}
</file>

<file path="app/actions/createPrinted.ts">
'use server'

import { mockStore } from '@/lib/mockStore'
import { revalidatePath } from 'next/cache'

/**
 * 3Dプリントされた新しい部品アイテムを作成するサーバーアクション
 * @param partId - 部品のID
 * @param qty - 数量
 * @param storageCaseLabel - 保管ケースのラベル（mock版では文字列）
 */
export async function createPrinted(
  partId: string | number,
  qty: number,
  storageCaseLabel: string
) {
  const pId = typeof partId === 'string' ? parseInt(partId, 10) : partId;

  // 指定された数量だけループを実行
  for (let i = 0; i < qty; i++) {
    await mockStore.addPartItem({
      part_id: pId,
      current_process: 'PRINTED',
      storage_case: storageCaseLabel,
      completed_at: null
    });
  }

  console.log(`Created ${qty} items for part ${pId}`);

  revalidatePath('/');
}
</file>

<file path="app/actions/updateProcess.ts">
'use server'

import { mockStore } from '@/lib/mockStore'
import { Process } from '@/app/types'
import { revalidatePath } from 'next/cache'

/**
 * 部品アイテムの工程を更新するサーバーアクション
 * @param itemId - 更新する部品アイテムのID
 * @param nextProcess - 次の工程名
 */
export async function updateProcess(
  itemId: string | number,
  nextProcess: string
) {
  // 文字列IDを数値に変換（mockStoreの仕様に合わせる）
  const id = typeof itemId === 'string' ? parseInt(itemId, 10) : itemId;

  // メモリ上のデータを更新
  await mockStore.updatePartItem(id, {
    current_process: nextProcess as Process,
    // READYに移行した場合は完了日時を設定
    completed_at: nextProcess === 'READY' ? new Date() : null
  });

  // 工程ログはモック版では省略、または必要なら追加
  console.log(`Updated item ${id} to process ${nextProcess}`);

  // キャッシュを更新してUIに反映
  revalidatePath('/');
  revalidatePath(`/item/${id}`);
}
</file>

<file path="app/project/[id]/page.tsx">
import Link from 'next/link';
import { notFound } from 'next/navigation';
import { aggregateProgress } from '@/app/utils';
import { SummaryCard } from '@/app/components/SummaryCard';
import { mockStore } from '@/lib/mockStore';
import ProjectClientContent from './ProjectClientContent';

interface PageProps {
    params: {
        id: string;
    };
}

/**
 * プロジェクト別進捗ページ（サーバー側）
 */
export default async function ProjectDetailPage({ params }: PageProps) {
    const projectId = parseInt(params.id);
    if (isNaN(projectId)) {
        notFound();
    }

    const project = await mockStore.getProject(projectId);
    if (!project) {
        notFound();
    }

    // データの取得
    const parts = await mockStore.getParts(projectId);
    const partItems = await mockStore.getPartItems(projectId);

    const totalInventory = partItems.length;
    const inProgress = partItems.filter(item => item.current_process !== 'READY').length;

    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const completedToday = partItems.filter(item =>
        item.completed_at && new Date(item.completed_at) >= today
    ).length;

    // 表示データの集計
    const progressData = aggregateProgress(parts, partItems);

    return (
        <div className="bg-gray-50 min-h-screen p-4 sm:p-6 lg:p-8 font-sans">
            <header className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                <div>
                    <Link href="/" className="text-blue-600 hover:text-blue-800 mb-2 inline-block font-medium">
                        ← プロジェクト一覧へ戻る
                    </Link>
                    <h1 className="text-3xl font-bold text-gray-800">
                        {project.name}
                    </h1>
                    <p className="text-gray-600 mt-1">{project.description}</p>
                </div>
                <div className="flex gap-3">
                    <Link href={`/print?project_id=${projectId}`}>
                        <span className="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-all cursor-pointer inline-block">
                            3Dプリント登録
                        </span>
                    </Link>
                </div>
            </header>

            {/* サマリーカード */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <SummaryCard title="総在庫数" value={totalInventory} />
                <SummaryCard title="仕掛品数" value={inProgress} valueColor="text-orange-500" />
                <SummaryCard title="本日完了数" value={completedToday} valueColor="text-green-500" />
            </div>

            {/* インタラクティブな一覧・カート機能 (クライアントコンポーネント) */}
            <ProjectClientContent
                progressData={progressData}
                projectId={projectId}
            />
        </div>
    );
}
</file>

<file path="package.json">
{
  "name": "sn-923",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "next": "^14.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "^5.3.0"
  }
}
</file>

<file path="app/item/[id]/page.tsx">
// mockStoreとサーバーアクションをインポート
import { mockStore } from '@/lib/mockStore'
import { updateProcess } from '@/app/actions/updateProcess'
import { consumeItem } from '@/app/actions/consumeItem'
import { PROCESSES } from '@/app/constants'
import Link from 'next/link'

// アイテム詳細ページのコンポーネント
export default async function ItemPage({ params }: { params: { id: string } }) {
  // 文字列IDを数値に変換
  const id = parseInt(params.id, 10);

  // mockStoreから特定の部品アイテムのデータを取得
  const data = await mockStore.getPartItem(id);

  if (!data) {
    return (
      <div className="p-8">
        <p>アイテムが見つかりませんでした (ID: {id})</p>
        <Link href="/" className="text-blue-600 underline">ダッシュボードに戻る</Link>
      </div>
    );
  }

  return (
    <div className="p-8 max-w-2xl mx-auto bg-white shadow-lg rounded-xl mt-10">
      <Link href={`/project/${data.parts.project_id}`} className="text-sm text-gray-500 hover:text-blue-600 mb-4 inline-block">
        ← プロジェクト別進捗に戻る
      </Link>

      <h1 className="text-3xl font-bold mb-6 text-gray-800">
        部品番号: {data.parts.part_number}
      </h1>

      <div className="bg-blue-50 p-4 rounded-lg mb-8 border border-blue-100">
        <p className="text-lg">
          <span className="font-semibold text-gray-600">現在工程:</span>{' '}
          <span className="text-blue-700 font-bold">{data.current_process}</span>
        </p>
        <p className="text-sm text-gray-500 mt-1">保管ケース: {data.storage_case}</p>
      </div>

      <div className="space-y-8">
        {/* 工程更新フォーム */}
        <section>
          <h2 className="text-xl font-semibold mb-4 text-gray-700">工程を更新する</h2>
          <form action={async (formData) => {
            'use server'
            const next = formData.get('next') as string;
            await updateProcess(id, next);
          }} className="flex gap-4">
            <select
              name="next"
              defaultValue={data.current_process}
              className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            >
              {PROCESSES.map(proc => (
                <option key={proc.key} value={proc.key}>{proc.name}</option>
              ))}
            </select>
            <button className="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors shadow-md">
              工程更新
            </button>
          </form>
        </section>

        <hr className="border-gray-100" />

        {/* 組み込み完了フォーム */}
        <section>
          <h2 className="text-xl font-semibold mb-4 text-gray-700">このアイテムを完了にする</h2>
          <form action={async () => {
            'use server'
            await consumeItem(id);
          }}>
            <button className="w-full bg-green-600 text-white font-bold py-4 px-8 rounded-lg hover:bg-green-700 transition-colors shadow-md text-lg">
              組み込み完了（在庫から除外）
            </button>
          </form>
        </section>
      </div>
    </div>
  )
}
</file>

<file path="app/print/page.tsx">
'use client';

import React, { useState } from 'react';
import Link from 'next/link';
import { useRouter, useSearchParams } from 'next/navigation';
import { parts as allParts } from '../data'; // 既存のテストデータを使用
import { PROCESSES } from '../constants'; // 工程定義を使用
import { createPrinted } from '../actions/createPrinted';

export default function PrintRegistrationPage() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const projectIdStr = searchParams.get('project_id');
  const projectId = projectIdStr ? parseInt(projectIdStr) : null;

  // プロジェクトIDがあればフィルタリング
  const filteredParts = projectId
    ? allParts.filter(p => p.project_id === projectId)
    : allParts;

  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [selectedPartId, setSelectedPartId] = useState<number>(filteredParts[0]?.id || 0);
  const [quantity, setQuantity] = useState(1);
  const [targetProcess, setTargetProcess] = useState('PRINTED');
  const [isSubmitting, setIsSubmitting] = useState(false);

  // ファイル選択時の処理
  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      setSelectedFile(file);
      // ファイル名に部品番号が含まれていれば自動選択する簡易ロジック
      const matchedPart = filteredParts.find(p => file.name.includes(p.part_number));
      if (matchedPart) setSelectedPartId(matchedPart.id);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);

    try {
      // サーバーアクションを呼び出してモックデータを更新
      await createPrinted(
        selectedPartId,
        quantity,
        selectedFile?.name || `JOB-${Date.now()}`
      );

      const redirectPath = projectId ? `/project/${projectId}` : '/';
      router.push(redirectPath);
      router.refresh();
    } catch (error) {
      alert('エラーが発生しました');
      console.error(error);
    } finally {
      setIsSubmitting(false);
    }
  };

  const backHref = projectId ? `/project/${projectId}` : '/';

  return (
    <div className="bg-gray-50 min-h-screen p-4 sm:p-8 font-sans">
      <div className="max-w-2xl mx-auto">
        <header className="mb-8">
          <Link href={backHref} className="text-blue-600 hover:underline mb-2 inline-block">
            ← {projectId ? 'プロジェクト別進捗に戻る' : 'ダッシュボードに戻る'}
          </Link>
          <h1 className="text-3xl font-bold text-gray-800">3Dプリント登録</h1>
        </header>

        <form onSubmit={handleSubmit} className="bg-white rounded-xl shadow-lg p-6 space-y-6">
          {/* STLファイルアップロード */}
          <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors">
            <input
              type="file"
              accept=".stl"
              onChange={handleFileChange}
              className="hidden"
              id="stl-upload"
            />
            <label htmlFor="stl-upload" className="cursor-pointer">
              <div className="text-gray-600">
                {selectedFile ? (
                  <span className="font-semibold text-blue-600">{selectedFile.name}</span>
                ) : (
                  "CADから出力したSTLファイルをアップロード"
                )}
              </div>
              <p className="text-sm text-gray-400 mt-2">クリックまたはドラッグ＆ドロップ</p>
            </label>
          </div>

          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {/* 部品選択 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">対象部品</label>
              <select
                value={selectedPartId}
                onChange={(e) => setSelectedPartId(Number(e.target.value))}
                className="w-full border-gray-300 rounded-md shadow-sm p-2 border"
              >
                {filteredParts.map(p => (
                  <option key={p.id} value={p.id}>{p.part_number}</option>
                ))}
              </select>
            </div>

            {/* 数量入力 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">数量</label>
              <input
                type="number"
                min="1"
                value={quantity}
                onChange={(e) => setQuantity(Number(e.target.value))}
                className="w-full border-gray-300 rounded-md shadow-sm p-2 border"
              />
            </div>
          </div>

          {/* ステータス選択 */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">登録時のステータス</label>
            <div className="flex gap-4 mt-2">
              {['UNPRINTED', 'PRINTED'].map((status) => (
                <label key={status} className="flex items-center">
                  <input
                    type="radio"
                    name="status"
                    value={status}
                    checked={targetProcess === status}
                    onChange={(e) => setTargetProcess(e.target.value)}
                    className="mr-2"
                  />
                  {PROCESSES.find(p => p.key === status)?.name}
                </label>
              ))}
            </div>
          </div>

          <button
            type="submit"
            disabled={isSubmitting}
            className={`w-full text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors text-lg ${isSubmitting ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'
              }`}
          >
            {isSubmitting ? '登録中...' : 'プリントジョブを登録'}
          </button>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/page.tsx">
import Link from 'next/link';
import { mockStore } from '@/lib/mockStore';

/**
 * プロジェクト一覧ダッシュボード
 */
export default async function ProjectsDashboardPage() {
  const projects = await mockStore.getProjects();

  return (
    <div className="bg-gray-50 min-h-screen p-4 sm:p-6 lg:p-8 font-sans">
      <header className="mb-12 text-center">
        <h1 className="text-4xl font-extrabold text-gray-900 mb-4 tracking-tight">
          BOM進捗管理システム
        </h1>
        <p className="text-xl text-gray-600 max-w-2xl mx-auto">
          プロジェクトを選択して、部品の製造工程と進捗状況をリアルタイムで確認できます。
        </p>
      </header>

      <div className="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        {projects.map((project) => (
          <Link key={project.id} href={`/project/${project.id}`}>
            <div className="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 overflow-hidden cursor-pointer flex flex-col h-full transform hover:-translate-y-1">
              <div className="p-8 flex-grow">
                <div className="flex justify-between items-start mb-6">
                  <h2 className="text-2xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors">
                    {project.name}
                  </h2>
                  <span className="bg-blue-50 text-blue-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">
                    進行中
                  </span>
                </div>
                <p className="text-gray-600 mb-8 leading-relaxed">
                  {project.description}
                </p>

                {/* 簡易進捗表示（ダミー） */}
                <div className="space-y-2">
                  <div className="flex justify-between text-sm">
                    <span className="font-medium text-gray-700">全体進捗</span>
                    <span className="font-bold text-blue-600">65%</span>
                  </div>
                  <div className="w-full bg-gray-100 rounded-full h-3">
                    <div className="bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full w-[65%] shadow-sm"></div>
                  </div>
                </div>
              </div>

              <div className="px-8 py-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center group-hover:bg-blue-50 transition-colors">
                <div className="text-sm">
                  <span className="text-gray-500">納期: </span>
                  <span className="font-semibold text-gray-800">{project.deadline}</span>
                </div>
                <span className="text-blue-600 font-bold flex items-center group-hover:translate-x-1 transition-transform">
                  詳細を見る
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                  </svg>
                </span>
              </div>
            </div>
          </Link>
        ))}
      </div>
    </div>
  );
}
</file>

</files>
